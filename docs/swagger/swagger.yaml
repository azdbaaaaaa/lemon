basePath: /api/v1
definitions:
  auth.ErrorResponse:
    properties:
      code:
        description: 错误码（非0表示错误）
        type: integer
      detail:
        description: 错误详情（可选）
        type: string
      message:
        description: 错误消息
        type: string
    type: object
  auth.LoginRequest:
    properties:
      password:
        description: 密码（必填）
        type: string
      username:
        description: 用户名（必填）
        type: string
    required:
    - password
    - username
    type: object
  auth.RefreshTokenRequest:
    properties:
      refresh_token:
        description: Refresh Token（必填）
        type: string
    required:
    - refresh_token
    type: object
  auth.RegisterRequest:
    properties:
      email:
        description: 邮箱（必填，需符合邮箱格式）
        type: string
      nickname:
        description: 昵称（可选）
        type: string
      password:
        description: 密码（必填，至少6位）
        minLength: 6
        type: string
      username:
        description: 用户名（必填，3-50字符）
        maxLength: 50
        minLength: 3
        type: string
    required:
    - email
    - password
    - username
    type: object
  novel.CreateNovelRequest:
    properties:
      resource_id:
        description: 资源ID（必填）
        type: string
      user_id:
        description: 用户ID（必填）
        type: string
      workflow_id:
        description: 工作流ID（必填）
        type: string
    required:
    - resource_id
    - user_id
    - workflow_id
    type: object
  novel.ErrorResponse:
    properties:
      code:
        description: 错误码（非0表示错误）
        type: integer
      detail:
        description: 错误详情（可选）
        type: string
      message:
        description: 错误消息
        type: string
    type: object
  novel.SplitChaptersRequest:
    properties:
      novel_id:
        description: 小说ID（必填）
        type: string
      target_chapters:
        description: 目标章节数（必填，至少1章）
        minimum: 1
        type: integer
    required:
    - novel_id
    - target_chapters
    type: object
  resource.ErrorResponse:
    properties:
      code:
        description: 错误码（非0表示错误）
        type: integer
      detail:
        description: 错误详情（可选）
        type: string
      message:
        description: 错误消息
        type: string
    type: object
host: localhost:8080
info:
  contact:
    email: support@lemon.ai
    name: API Support
  description: |-
    Lemon is an AI-powered API service built with Eino framework.
    It provides LLM chat, intelligent agent, and more AI capabilities.
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html
  title: Lemon API
  version: "1.0"
paths:
  /api/v1/auth/login:
    post:
      consumes:
      - application/json
      description: 用户登录，返回Access Token和Refresh Token
      parameters:
      - description: 登录请求
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/auth.LoginRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/auth.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/auth.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/auth.ErrorResponse'
      summary: 用户登录
      tags:
      - 认证
  /api/v1/auth/logout:
    post:
      consumes:
      - application/json
      description: 退出登录，使Token失效
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/auth.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/auth.ErrorResponse'
      security:
      - BearerAuth: []
      summary: 退出登录
      tags:
      - 认证
  /api/v1/auth/me:
    get:
      consumes:
      - application/json
      description: 获取当前登录用户的详细信息
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/auth.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/auth.ErrorResponse'
      security:
      - BearerAuth: []
      summary: 获取当前用户信息
      tags:
      - 认证
  /api/v1/auth/refresh:
    post:
      consumes:
      - application/json
      description: 使用Refresh Token刷新Access Token
      parameters:
      - description: 刷新Token请求
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/auth.RefreshTokenRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/auth.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/auth.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/auth.ErrorResponse'
      summary: 刷新Token
      tags:
      - 认证
  /api/v1/auth/register:
    post:
      consumes:
      - application/json
      description: 注册新用户，注册后状态为inactive，需要管理员审核
      parameters:
      - description: 注册请求
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/auth.RegisterRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/auth.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/auth.ErrorResponse'
      summary: 用户注册
      tags:
      - 认证
  /api/v1/novels:
    post:
      consumes:
      - application/json
      description: 根据资源ID创建小说，返回小说ID。这是小说处理流程的第一步。
      parameters:
      - description: 创建小说请求
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/novel.CreateNovelRequest'
      produces:
      - application/json
      responses:
        "201":
          description: '成功响应"  "{\"code\": 0, \"message\": \"小说创建成功\", \"data\": {\"novel_id\":
            \"...\"}}'
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 请求参数错误
          schema:
            $ref: '#/definitions/novel.ErrorResponse'
        "500":
          description: 服务器内部错误
          schema:
            $ref: '#/definitions/novel.ErrorResponse'
      summary: 创建小说
      tags:
      - 小说管理
  /api/v1/novels/{novel_id}:
    get:
      consumes:
      - application/json
      description: 根据小说ID获取小说的详细信息
      parameters:
      - description: 小说ID
        in: path
        name: novel_id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: '成功响应"  "{\"code\": 0, \"message\": \"success\", \"data\":
            {\"novel\": {...}}}'
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 请求参数错误
          schema:
            $ref: '#/definitions/novel.ErrorResponse'
        "404":
          description: 小说不存在
          schema:
            $ref: '#/definitions/novel.ErrorResponse'
        "500":
          description: 服务器内部错误
          schema:
            $ref: '#/definitions/novel.ErrorResponse'
      summary: 获取小说信息
      tags:
      - 小说管理
  /api/v1/novels/{novel_id}/chapters:
    get:
      consumes:
      - application/json
      description: 根据小说ID获取该小说的所有章节列表，按序号排序
      parameters:
      - description: 小说ID
        in: path
        name: novel_id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: '成功响应"  "{\"code\": 0, \"message\": \"success\", \"data\":
            {\"novel_id\": \"...\", \"chapters\": [...], \"count\": 10}}'
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 请求参数错误
          schema:
            $ref: '#/definitions/novel.ErrorResponse'
        "500":
          description: 服务器内部错误
          schema:
            $ref: '#/definitions/novel.ErrorResponse'
      summary: 获取章节列表
      tags:
      - 章节管理
  /api/v1/novels/{novel_id}/chapters/split:
    post:
      consumes:
      - application/json
      description: 根据小说内容切分章节，将小说文本按照目标章节数切分成多个章节。这是小说处理流程的第二步。
      parameters:
      - description: 切分章节请求
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/novel.SplitChaptersRequest'
      produces:
      - application/json
      responses:
        "200":
          description: '成功响应"  "{\"code\": 0, \"message\": \"章节切分成功\", \"data\": {\"novel_id\":
            \"...\", \"target_chapters\": 10, \"message\": \"已切分为 10 个章节\"}}'
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 请求参数错误
          schema:
            $ref: '#/definitions/novel.ErrorResponse'
        "500":
          description: 服务器内部错误
          schema:
            $ref: '#/definitions/novel.ErrorResponse'
      summary: 切分章节
      tags:
      - 章节管理
  /api/v1/novels/chapters/{chapter_id}/videos/final:
    post:
      consumes:
      - application/json
      description: 拼接所有 narration 视频，添加 finish.mp4，生成章节的最终完整视频。需要确保所有 narration 视频已完成（status=completed）。
      parameters:
      - description: 章节ID
        in: path
        name: chapter_id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: '成功响应"  "{\"code\": 0, \"message\": \"最终视频生成成功\", \"data\":
            {\"video_id\": \"...\", \"chapter_id\": \"...\"}}'
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 请求参数错误（如没有找到 narration 视频）
          schema:
            $ref: '#/definitions/novel.ErrorResponse'
        "500":
          description: 服务器内部错误
          schema:
            $ref: '#/definitions/novel.ErrorResponse'
      summary: 生成章节的最终完整视频
      tags:
      - 视频生成
  /api/v1/novels/chapters/{chapter_id}/videos/narration:
    post:
      consumes:
      - application/json
      description: 为章节生成所有 narration 视频，所有分镜都单独生成视频，使用图生视频方式（Ark API 或 FFmpeg）。视频生成是异步的，提交任务后需要通过状态查询接口轮询进度。
      parameters:
      - description: 章节ID
        in: path
        name: chapter_id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: '成功响应"  "{\"code\": 0, \"message\": \"视频生成任务已提交\", \"data\":
            {\"video_ids\": [\"...\"], \"count\": 1, \"chapter_id\": \"...\"}}'
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 请求参数错误
          schema:
            $ref: '#/definitions/novel.ErrorResponse'
        "500":
          description: 服务器内部错误
          schema:
            $ref: '#/definitions/novel.ErrorResponse'
      summary: 生成章节的 narration 视频
      tags:
      - 视频生成
  /api/v1/novels/chapters/{chapter_id}/videos/versions:
    get:
      consumes:
      - application/json
      description: 获取章节的所有视频版本号，用于查看历史版本或选择特定版本。每次生成视频都会创建新版本。
      parameters:
      - description: 章节ID
        in: path
        name: chapter_id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: '成功响应"  "{\"code\": 0, \"message\": \"success\", \"data\":
            {\"versions\": [1, 2, 3], \"count\": 3, \"chapter_id\": \"...\"}}'
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 请求参数错误
          schema:
            $ref: '#/definitions/novel.ErrorResponse'
        "500":
          description: 服务器内部错误
          schema:
            $ref: '#/definitions/novel.ErrorResponse'
      summary: 获取章节的视频版本号列表
      tags:
      - 视频查询
  /api/v1/resources:
    get:
      consumes:
      - application/json
      description: 查询资源列表，支持按用户ID、扩展名、状态等条件筛选，支持分页
      parameters:
      - description: 用户ID
        in: query
        name: user_id
        type: string
      - description: 文件扩展名筛选
        in: query
        name: ext
        type: string
      - description: 状态筛选
        in: query
        name: status
        type: string
      - description: 页码（默认1）
        in: query
        name: page
        type: integer
      - description: 每页数量（默认20，最大100）
        in: query
        name: page_size
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '成功响应"  "{\"code\": 0, \"message\": \"success\", \"data\":
            {\"resources\": [...], \"total\": 100, \"page\": 1, \"page_size\": 20}}'
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 请求参数错误
          schema:
            $ref: '#/definitions/resource.ErrorResponse'
        "500":
          description: 服务器内部错误
          schema:
            $ref: '#/definitions/resource.ErrorResponse'
      summary: 查询资源列表
      tags:
      - 资源管理
  /api/v1/resources/{resource_id}:
    get:
      consumes:
      - application/json
      description: 根据资源ID获取资源的详细信息（元数据，不包含文件内容）
      parameters:
      - description: 资源ID
        in: path
        name: resource_id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: '成功响应"  "{\"code\": 0, \"message\": \"success\", \"data\":
            {\"resource\": {...}}}'
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 请求参数错误
          schema:
            $ref: '#/definitions/resource.ErrorResponse'
        "404":
          description: 资源不存在
          schema:
            $ref: '#/definitions/resource.ErrorResponse'
        "500":
          description: 服务器内部错误
          schema:
            $ref: '#/definitions/resource.ErrorResponse'
      summary: 获取资源信息
      tags:
      - 资源管理
  /api/v1/resources/{resource_id}/download:
    get:
      consumes:
      - application/json
      description: 根据资源ID下载文件，返回文件流
      parameters:
      - description: 资源ID
        in: path
        name: resource_id
        required: true
        type: string
      produces:
      - application/octet-stream
      responses:
        "200":
          description: 文件流
          schema:
            type: file
        "400":
          description: 请求参数错误
          schema:
            $ref: '#/definitions/resource.ErrorResponse'
        "404":
          description: 资源不存在
          schema:
            $ref: '#/definitions/resource.ErrorResponse'
        "500":
          description: 服务器内部错误
          schema:
            $ref: '#/definitions/resource.ErrorResponse'
      summary: 下载文件
      tags:
      - 资源管理
  /api/v1/resources/{resource_id}/download-url:
    get:
      consumes:
      - application/json
      description: 根据资源ID获取预签名的下载URL，适用于客户端直接下载
      parameters:
      - description: 资源ID
        in: path
        name: resource_id
        required: true
        type: string
      - description: 过期时间（秒，默认3600）
        in: query
        name: expires_in
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '成功响应"  "{\"code\": 0, \"message\": \"success\", \"data\":
            {\"resource_id\": \"...\", \"download_url\": \"...\", \"expires_at\":
            \"...\", \"file_name\": \"...\", \"file_size\": 1024, \"content_type\":
            \"...\"}}'
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 请求参数错误
          schema:
            $ref: '#/definitions/resource.ErrorResponse'
        "404":
          description: 资源不存在
          schema:
            $ref: '#/definitions/resource.ErrorResponse'
        "500":
          description: 服务器内部错误
          schema:
            $ref: '#/definitions/resource.ErrorResponse'
      summary: 获取下载URL
      tags:
      - 资源管理
  /api/v1/resources/upload:
    post:
      consumes:
      - multipart/form-data
      description: 通过 multipart/form-data 上传文件到服务端，服务端会保存文件并创建资源记录
      parameters:
      - description: 上传的文件
        in: formData
        name: file
        required: true
        type: file
      - description: 用户ID（可选，如果为空则从认证信息中获取）
        in: formData
        name: user_id
        type: string
      produces:
      - application/json
      responses:
        "201":
          description: '成功响应"  "{\"code\": 0, \"message\": \"文件上传成功\", \"data\": {\"resource_id\":
            \"...\", \"resource_url\": \"...\", \"file_size\": 1024, \"file_name\":
            \"...\"}}'
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 请求参数错误
          schema:
            $ref: '#/definitions/resource.ErrorResponse'
        "500":
          description: 服务器内部错误
          schema:
            $ref: '#/definitions/resource.ErrorResponse'
      summary: 上传文件
      tags:
      - 资源管理
  /api/v1/videos:
    get:
      consumes:
      - application/json
      description: 根据状态查询视频列表，用于轮询视频生成进度。支持的状态：pending（待处理）、processing（处理中）、completed（已完成）、failed（失败）
      parameters:
      - description: 视频状态：pending, processing, completed, failed
        in: query
        name: status
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: '成功响应"  "{\"code\": 0, \"message\": \"success\", \"data\":
            {\"videos\": [...], \"count\": 1, \"status\": \"pending\"}}'
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 请求参数错误（如 status 参数无效）
          schema:
            $ref: '#/definitions/novel.ErrorResponse'
        "500":
          description: 服务器内部错误
          schema:
            $ref: '#/definitions/novel.ErrorResponse'
      summary: 根据状态查询视频
      tags:
      - 视频查询
  /health:
    get:
      consumes:
      - application/json
      description: 检查服务健康状态
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 健康检查
      tags:
      - 健康检查
  /ready:
    get:
      consumes:
      - application/json
      description: 检查服务是否就绪
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 就绪检查
      tags:
      - 健康检查
schemes:
- http
- https
securityDefinitions:
  BearerAuth:
    description: Type "Bearer" followed by a space and JWT token.
    in: header
    name: Authorization
    type: apiKey
swagger: "2.0"
